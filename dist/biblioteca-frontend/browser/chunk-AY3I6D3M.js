import{a as z,b as G,c as J,d as K,e as Q,f as W,g as X,h as Y,i as Z,j as tt,k as et}from"./chunk-SIFPFGDB.js";import{a as U,b as j,c as q}from"./chunk-Z67DRW2S.js";import{a as V,b as F}from"./chunk-HOYRRN2X.js";import{a as O}from"./chunk-WKR6BCLY.js";import{a as nt}from"./chunk-7MM5G3DC.js";import"./chunk-BI2JVPFO.js";import{F as H,G as N,q as k,w as A}from"./chunk-XGSNQAZ3.js";import{I as B,K as R,L as $}from"./chunk-YOF6ZWVV.js";import{f as P}from"./chunk-72KRNO7Q.js";import{$ as f,Ab as _,Bb as p,Db as L,Fb as M,Gc as T,Hb as d,Jc as w,Kc as I,Pa as m,Rb as E,Vb as r,Wb as D,Xb as u,dc as v,ea as g,eb as y,fa as x,fc as S,gc as b,ib as l,tb as s,ub as o,vb as a,wb as h}from"./chunk-PS7QTO7M.js";function it(t,n){if(t&1){let e=L();o(0,"button",5),M("click",function(){g(e);let c=d();return x(c.createLoan())}),o(1,"mat-icon"),r(2,"add"),a(),r(3," Nuevo Pr\xE9stamo "),a()}}function at(t,n){t&1&&(o(0,"th",17),r(1,"Libro"),a())}function ot(t,n){if(t&1&&(o(0,"td",18),r(1),a()),t&2){let e=n.$implicit,i=d(2);m(),u(" ",i.getBookTitle(e.book)," ")}}function rt(t,n){t&1&&(o(0,"th",17),r(1,"Usuario"),a())}function mt(t,n){if(t&1&&(o(0,"td",18),r(1),a()),t&2){let e=n.$implicit,i=d(3);m(),u(" ",i.getUserName(e.user)," ")}}function lt(t,n){t&1&&(_(0,19),l(1,rt,2,0,"th",8)(2,mt,2,1,"td",9),p())}function ct(t,n){t&1&&(o(0,"th",17),r(1,"Fecha L\xEDmite"),a())}function st(t,n){if(t&1&&(o(0,"td",18),r(1),v(2,"date"),a()),t&2){let e=n.$implicit;m(),u(" ",S(2,1,e.dueDate,"dd/MM/yyyy")," ")}}function dt(t,n){t&1&&(o(0,"th",17),r(1,"Estado"),a())}function _t(t,n){if(t&1&&(o(0,"td",18)(1,"mat-chip-set")(2,"mat-chip",20),r(3),a()()()),t&2){let e=n.$implicit,i=d(2);m(2),s("color",e.returned?"accent":i.isOverdue(e)?"warn":"primary")("highlighted",!0),m(),u(" ",e.returned?"Devuelto":i.isOverdue(e)?"Vencido":"Activo"," ")}}function pt(t,n){t&1&&(o(0,"th",17),r(1,"Fecha Devoluci\xF3n"),a())}function ut(t,n){if(t&1&&(o(0,"td",18),r(1),v(2,"date"),a()),t&2){let e=n.$implicit;m(),u(" ",e.returnedAt?S(2,1,e.returnedAt,"dd/MM/yyyy"):"-"," ")}}function ft(t,n){t&1&&(o(0,"th",17),r(1,"Acciones"),a())}function Ct(t,n){if(t&1){let e=L();o(0,"button",23),M("click",function(){g(e);let c=d().$implicit,C=d(3);return x(C.returnLoan(c))}),o(1,"mat-icon"),r(2,"assignment_return"),a()()}}function gt(t,n){if(t&1&&(o(0,"td",18),l(1,Ct,3,0,"button",22),a()),t&2){let e=n.$implicit;m(),s("ngIf",!e.returned)}}function xt(t,n){t&1&&(_(0,21),l(1,ft,2,0,"th",8)(2,gt,2,1,"td",9),p())}function ht(t,n){t&1&&h(0,"tr",24)}function Lt(t,n){t&1&&h(0,"tr",25)}function Mt(t,n){if(t&1&&(o(0,"mat-card")(1,"table",6),_(2,7),l(3,at,2,0,"th",8)(4,ot,2,1,"td",9),p(),l(5,lt,3,0,"ng-container",10),_(6,11),l(7,ct,2,0,"th",8)(8,st,3,4,"td",9),p(),_(9,12),l(10,dt,2,0,"th",8)(11,_t,4,3,"td",9),p(),_(12,13),l(13,pt,2,0,"th",8)(14,ut,3,4,"td",9),p(),l(15,xt,3,0,"ng-container",14)(16,ht,1,0,"tr",15)(17,Lt,1,0,"tr",16),a()()),t&2){let e=d();m(),s("dataSource",e.loans),m(4),s("ngIf",e.isAdmin),m(10),s("ngIf",e.isAdmin),m(),s("matHeaderRowDef",e.displayedColumns),m(),s("matRowDefColumns",e.displayedColumns)}}function vt(t,n){t&1&&(o(0,"div",26)(1,"mat-icon"),r(2,"assignment"),a(),o(3,"p"),r(4,"No hay pr\xE9stamos registrados"),a()())}var Ut=(()=>{class t{loansService=f(nt);authService=f(O);router=f(P);snackBar=f(H);loans=[];get isAdmin(){return this.authService.isAdmin}get displayedColumns(){return this.isAdmin?["book","user","dueDate","status","returnedAt","actions"]:["book","dueDate","status","returnedAt"]}ngOnInit(){this.loadLoans()}loadLoans(){(this.isAdmin?this.loansService.getAllLoans():this.loansService.getMyLoans()).subscribe({next:i=>{i.success&&i.loans&&(this.loans=i.loans)},error:i=>{this.snackBar.open("Error al cargar pr\xE9stamos","Cerrar",{duration:3e3})}})}createLoan(){this.router.navigate(["/loans/new"])}returnLoan(e){confirm("\xBFMarcar este pr\xE9stamo como devuelto?")&&this.loansService.returnLoan(e._id).subscribe({next:i=>{i.success&&(this.snackBar.open(i.message||"Pr\xE9stamo devuelto","Cerrar",{duration:3e3}),this.loadLoans())},error:i=>{let c=i.error?.message||"Error al devolver pr\xE9stamo";this.snackBar.open(c,"Cerrar",{duration:3e3})}})}getBookTitle(e){return typeof e=="string"?e:e.title}getUserName(e){return typeof e=="string"?e:`${e.firstName} ${e.lastName}`}isOverdue(e){return e.returned?!1:new Date(e.dueDate)<new Date}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=y({type:t,selectors:[["app-loans-list"]],decls:8,vars:4,consts:[["noLoans",""],[1,"loans-container"],[1,"header"],["mat-raised-button","","color","primary",3,"click",4,"ngIf"],[4,"ngIf","ngIfElse"],["mat-raised-button","","color","primary",3,"click"],["mat-table","",1,"loans-table",3,"dataSource"],["matColumnDef","book"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","user",4,"ngIf"],["matColumnDef","dueDate"],["matColumnDef","status"],["matColumnDef","returnedAt"],["matColumnDef","actions",4,"ngIf"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["matColumnDef","user"],[3,"color","highlighted"],["matColumnDef","actions"],["mat-icon-button","","color","primary","matTooltip","Marcar como devuelto",3,"click",4,"ngIf"],["mat-icon-button","","color","primary","matTooltip","Marcar como devuelto",3,"click"],["mat-header-row",""],["mat-row",""],[1,"no-loans"]],template:function(i,c){if(i&1&&(o(0,"div",1)(1,"div",2)(2,"h1"),r(3),a(),l(4,it,4,0,"button",3),a(),l(5,Mt,18,5,"mat-card",4)(6,vt,5,0,"ng-template",null,0,b),a()),i&2){let C=E(7);m(3),D(c.isAdmin?"Todos los Pr\xE9stamos":"Mis Pr\xE9stamos"),m(),s("ngIf",c.isAdmin),m(),s("ngIf",c.loans.length>0)("ngIfElse",C)}},dependencies:[I,T,A,k,$,R,B,F,V,N,q,U,j,et,z,J,X,K,G,Y,Q,W,Z,tt,w],styles:[".loans-container[_ngcontent-%COMP%]{padding:24px;max-width:1400px;margin:0 auto}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}h1[_ngcontent-%COMP%]{margin:0;color:#333}.loans-table[_ngcontent-%COMP%]{width:100%}.loans-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:600;background-color:#f5f5f5}.loans-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .loans-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:12px 16px}mat-chip-set[_ngcontent-%COMP%]{display:inline-flex}.no-loans[_ngcontent-%COMP%]{text-align:center;padding:48px;color:#999}.no-loans[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:64px;width:64px;height:64px;margin-bottom:16px}.no-loans[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:18px}"]})}return t})();export{Ut as LoansListComponent};
